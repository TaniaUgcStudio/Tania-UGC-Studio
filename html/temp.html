<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Globe with Interactive Points</title>
    <style>
        body { margin: 0; overflow: hidden; font-family: Georgia, serif, Arial, sans-serif; }
        canvas { display: block; }
        #info { 
            position: absolute; 
            top: 10px; 
            left: 10px; 
            color: white; 
            background: rgba(0, 0, 0, 0.7); 
            padding: 10px; 
            border-radius: 5px; 
            max-width: 300px; 
        }
        #popup { 
            position: absolute; 
            background: rgba(0, 0, 0, 0.8); 
            color: white; 
            padding: 8px; 
            border-radius: 5px; 
            display: none; 
            pointer-events: none; 
        }
        .text-overlay { 
            position: absolute; 
            bottom: 20px; 
            left: 50%; 
            transform: translateX(-50%); 
            color: white; 
            background: rgba(0, 0, 0, 0.7); 
            padding: 15px; 
            border-radius: 10px; 
            text-align: center; 
            max-width: 600px; 
            font-size: 16px; 
        }
        .text-overlay strong { 
            color: #FFFDD0; 
        }
        /***************************** MOBILE STYLES *****************************/
        @media (max-width: 600px) {
            .text-overlay { 
              width: 85%;
            }
          }
    </style>
</head>
<body>
    <div id="info">- ¡Haz clic o toca los puntos brillantes para ver información sobre la empresa!<br>- Arrastra para rotar el globo.</div>
    <div id="popup"></div>
    <!-- Market Content -->
    <div class="text-overlay">
        Más de <strong>300 creadores y marcas</strong> ya confían en mí cada día para recibir contenidos únicos y hechos a medida.  
        <br><br>
        ¿Quieres llevar tus redes al siguiente nivel?  
        <strong>Escríbeme hoy</strong> y recibe el contenido especial que tu proyecto merece ✨
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script>
        // Set up scene, camera, and renderer
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer();
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        // Add orbit controls
        const controls = new THREE.OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.dampingFactor = 0.05;
        controls.autoRotate = false;

        // Load textures
        const textureLoader = new THREE.TextureLoader();
        const mapTexture = textureLoader.load('https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/textures/planets/earth_atmos_2048.jpg');
        const bumpTexture = textureLoader.load('https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/textures/planets/earth_bump_2048.jpg');

        // Create globe with world map texture
        const radius = 15;
        const geometry = new THREE.SphereGeometry(radius, 64, 64);
        const material = new THREE.MeshPhongMaterial({
            map: mapTexture,
            bumpMap: bumpTexture,
            bumpScale: 0.1,
            specular: 0x555555,
            shininess: 30
        });
        const globe = new THREE.Mesh(geometry, material);
        scene.add(globe);

        // Add lighting
        const ambientLight = new THREE.AmbientLight(0x404040);
        scene.add(ambientLight);
        const directionalLight = new THREE.DirectionalLight(0xffffff, 0.5);
        directionalLight.position.set(10, 10, 10);
        scene.add(directionalLight);

        // Define points (40 in Spain, 5 in Germany, 5 in France)
        const pointsData = [
            // Spain (40 points)
            { lat: 40.416775, lon: -3.703790, name: "Compañía de Moda, Madrid" },
            { lat: 41.385064, lon: 2.173404, name: "Compañía de Joyas, Barcelona" },
            { lat: 37.389092, lon: -5.984459, name: "Estudio de Diseño, Seville" },
            { lat: 39.469907, lon: -0.376288, name: "Agencia de Publicidad, Valencia" },
            { lat: 43.263013, lon: -2.934985, name: "Marca de Arte, Bilbao" },
            { lat: 40.463667, lon: -3.749220, name: "Estudio de Fotografía, Madrid" },
            { lat: 41.403638, lon: 2.174355, name: "Tienda de Accesorios, Barcelona" },
            { lat: 37.392529, lon: -5.975137, name: "Productora de Vídeo, Seville" },
            { lat: 39.466667, lon: -0.375000, name: "Marca de Ropa, Valencia" },
            { lat: 43.257795, lon: -2.923739, name: "Galería de Arte, Bilbao" },
            // Add 30 more random points in Spain
            ...Array(30).fill().map((_, i) => ({
                lat: 36 + Math.random() * 8,
                lon: -9 + Math.random() * 7,
                name: `Creador de Contenido ${i + 1}, Spain`
            })),
            // Germany (5 points)
            { lat: 52.520008, lon: 13.404954, name: "Compañía de Tecnología, Berlin" },
            { lat: 48.137154, lon: 11.576124, name: "Estudio de Diseño, Munich" },
            { lat: 50.110924, lon: 8.682127, name: "Agencia de Marketing, Frankfurt" },
            { lat: 53.551085, lon: 9.993682, name: "Marca de Moda, Hamburg" },
            { lat: 50.937531, lon: 6.960279, name: "Productora de Eventos, Cologne" },
            // France (5 points)
            { lat: 48.856614, lon: 2.352222, name: "Compañía de Moda, Paris" },
            { lat: 43.296482, lon: 5.369780, name: "Estudio de Arte, Marseille" },
            { lat: 45.764043, lon: 4.835659, name: "Marca de Joyas, Lyon" },
            { lat: 43.610769, lon: 1.444209, name: "Agencia Creativa, Toulouse" },
            { lat: 47.218371, lon: -1.553621, name: "Productora de Vídeo, Nantes" }
        ];

        // Convert lat/lon to 3D coordinates
        function latLonToVector3(lat, lon, radius) {
            const phi = (90 - lat) * Math.PI / 180;
            const theta = (lon + 180) * Math.PI / 180;
            return new THREE.Vector3(
                -radius * Math.sin(phi) * Math.cos(theta),
                radius * Math.cos(phi),
                radius * Math.sin(phi) * Math.sin(theta)
            );
        }

        // Create glowing points and parent them to the globe
        const points = [];
        pointsData.forEach(point => {
            const pointGeometry = new THREE.SphereGeometry(0.08, 16, 16);
            const pointMaterial = new THREE.MeshBasicMaterial({ color: 0xFFFDD0 });
            const pointMesh = new THREE.Mesh(pointGeometry, pointMaterial);
            const position = latLonToVector3(point.lat, point.lon, radius + 0.15);
            pointMesh.position.copy(position);
            pointMesh.userData = { name: point.name };
            globe.add(pointMesh);
            points.push(pointMesh);
        });

        // Set up raycaster for clicking
        const raycaster = new THREE.Raycaster();
        const mouse = new THREE.Vector2();
        let selectedPoint = null;
        const popup = document.getElementById('popup');

        // Handle mouse clicks
        function handleInteraction(event, clientX, clientY) {
            event.preventDefault();
            mouse.x = (clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(clientY / window.innerHeight) * 2 + 1;
            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(points);
            if (intersects.length > 0) {
                const point = intersects[0].object;
                popup.innerText = point.userData.name;
                popup.style.display = 'block';
                popup.style.left = `${clientX + 10}px`;
                popup.style.top = `${clientY - 10}px`;
                selectedPoint = point;
                document.getElementById('info').innerText = `Selected: ${point.userData.name}`;
            } else {
                popup.style.display = 'none';
                document.getElementById('info').innerText = 'Click or tap on glowing points to see company info! Drag to rotate the globe.';
                selectedPoint = null;
            }
        }

        window.addEventListener('click', (event) => {
            handleInteraction(event, event.clientX, event.clientY);
        });

        // Handle touch events for mobile
        window.addEventListener('touchstart', (event) => {
            const touch = event.touches[0];
            handleInteraction(event, touch.clientX, touch.clientY);
        });

        // Position camera to focus on Spain (centered on Madrid)
        const spainPosition = latLonToVector3(40.416775, -3.703790, radius + 20);
        camera.position.copy(spainPosition);
        camera.lookAt(0, 0, 0);

        // Animation loop
        let time = 0;
        function animate() {
            requestAnimationFrame(animate);

            // Animate points (slow subtle glow)
            time += 0.02;
            points.forEach(point => {
                const scale = 1 + 0.2 * Math.sin(time + point.position.x);
                point.scale.set(scale, scale, scale);
            });

            // Highlight selected point
            if (selectedPoint) {
                selectedPoint.material.color.set(0xff0000);
                selectedPoint.scale.set(1.3, 1.3, 1.3);
            } else {
                points.forEach(point => point.material.color.set(0xFFFDD0));
            }

            controls.update();
            renderer.render(scene, camera);
        }
        animate();

        // Handle window resize
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>